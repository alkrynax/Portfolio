<!DOCTYPE html>
<html>

<head>
  <style>
    #gameCanvas {
      background-color: #000;
      border: 1px solid #fff;
    }
  </style>
</head>

<body>
  <canvas id="gameCanvas" width="480" height="320"></canvas>

  <script>
    //Définition des variables
    var canvas;
    var context;
    var player;
    var projectiles = [];
    var invaderY = 50; // Position en Y des envahisseurs
    var invaderImage = new Image();
    invaderImage.src = "/invader/image.png"
    var invaderSpeed = 3;
    var invaderDirection = 1;
    var score = 0;

    function init() {
      //Création du terrain de jeu et positionnement du joueur
      canvas = document.getElementById("gameCanvas");
      context = canvas.getContext("2d");
      player = {
        x: canvas.width / 2,
        y: canvas.height - 30,
        width: 20,
        height: 20
      };

    }

    function draw() {
      // Efface le contenu précédent du canevas
      context.clearRect(0, 0, canvas.width, canvas.height);

      // Dessine les éléments du jeu

      requestAnimationFrame(draw);
    }

    function drawPlayer() {
      //Création du joueur sous la forme basique d'un rectangle
      context.fillStyle = "#FFFFFF";
      context.fillRect(player.x, player.y, player.width, player.height);
    }

    function drawProjectiles() {
      context.fillStyle = "#EB0707";

      for (var i = 0; i < projectiles.length; i++) {
        context.fillRect(projectiles[i].x, projectiles[i].y, 2, 10);
      }
    }

    function drawInvaders() {
      for (var i = 0; i < invaders.length; i++) {
        context.drawImage(invaderImage, invaders[i].x, invaderY, invaders[i].width, invaders[i].height);
      }
    }

    function updateProjectiles() {
      for (var i = 0; i < projectiles.length; i++) {
        projectiles[i].y -= 2;

        if (projectiles[i].y < 0) {
          projectiles.splice(i, 1);
          i--;
        }
      }
    }

    function updateInvaders() {
      var reachedEdge = False;
      for (var i = 0; i < invaders.length; i++) {
        invaders[i].x += invaderSpeed * invaderDirection;

        if (invaders[i].x > canvas.width - invaders[i].width || invaders[i].x < 0) {
          reachedEdge = True;
        }
      }
      if (reachedEdge == True) {
        invaderDirection *= -1;
        invaderY += 50;
      }
    }

    function checkCollision() {
      for (var i = 0; i < projectiles.length; i++) {
        for (var j = 0; j < invaders.length; j++) {
          if (
            projectiles[i].x < invaders[j].x + invaders[j].width &&
            projectiles[i].x + 2 > invaders[j].x &&
            projectiles[i].y < invaders[j].y + invaders[j].height &&
            projectiles[i].y + 10 > invaders[j].y
          ) {
            invaders.splice(j, 1);
            j--;
            projectiles.splice(i, 1);
            i++;
            score += 50;
          }
        }
      }
    }

    function score() {
      context.font = "16px Arial";
      context.fillStyle = "#01D918";
      context.fillText("Score" + score, 8, 20);
    }

    function GameOver() {
      context.font = "30px Arial";
      context.fillStyle = "#01D918";
      context.fillText("Game Over", canvas.height / 2 - 80, canvas.width / 2 - 15)
    }

    document.addEventListener("keydown", function (event) {
      //Définition de la surface de déplacement du joueur et de la vitesse
      var playerSpeed = 5;
      var playerMinX = 30;
      var playerMaxX = canvas.width - player.width - 30;
      var playerMinY = 30;
      var playerMaxY = canvas.height / 2 - player.height - 30;

      document.addEventListener("keydown", function (event) {
        //Movement à l'aide des flèches avec déplacement dans les quatre directions
        if (event.key === "ArrowLeft" || event.key === "ArrowUp") {
          player.x -= playerSpeed;
          if (player.x < playerMinX) {
            player.x = playerMinX;
          }
        } else if (event.key === "ArrowRight" || event.key === "ArrowDown") {
          player.x += playerSpeed;
          if (player.x > playerMaxX) {
            player.x = playerMaxX;
          }
        }

        if (event.key === "ArrowUp" || event.key === "ArrowDown") {
          event.preventDefault();
          // Empêche le défilement de la page lors de l'utilisation des flèches haut/bas
        }

        if (event.key === "ArrowUp") {
          player.y -= playerSpeed;
          if (player.y < playerMinY) {
            player.y = playerMinY;
          }
        } else if (event.key === "ArrowDown") {
          player.y += playerSpeed;
          if (player.y > playerMaxY) {
            player.y = playerMaxY;
          }
        }
      });

    });
    document.addEventListener("keydown", function (event) {
      if (event.key === " ") {
        projectiles.push({
          x: player.x + player.width / 2,
          y: player.y
        });
      }
    });

    function gameLoop() {
      context.clearRect(0, 0, canvas.width, canvas.height);
      drawPlayer();
      drawInvaders();
      drawProjectiles();
      updateProjectiles();
      checkCollision();
      score();

    }
    setInterval(gameLoop, 16);
  </script>

</body>

</html>